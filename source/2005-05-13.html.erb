---
title: "メモ自宅でサーバをたちあげようとすると二つ問題があって, ひとつは名前の問題"
date: 2005-05-13
---
<p>メモ</p><p>自宅でサーバをたちあげようとすると二つ問題があって, ひとつは名前の問題. これは <a href="http://www.dyndns.org/">dyndns</a> を使うと済む. もう一つは NAT の問題で, これは使っているルータにもよるけれど, UPnP でポートマップをすれば済む. 最初は Windos XP の <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/upnp/upnp/universal_plug_and_play_start_page.asp">Universal Plug and Play SDK</a> を使ってみたがいまいちうまくいかず, <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/ics/ics/windows_firewall_start_page.asp">Windows Firewall API</a> も使い方がよくわからず, Google でみつけた謎の API を使ったら解決した. この API が一体なんなのかは結局よくわからない. しかし動いてはいる. 以下抜粋. </p><p></p><pre><p> function local_ip_addr() {</p><p> 	var reg0 = new RegExp("IP Address");</p><p> 	var reg1 = new RegExp("192\\.168\\.0\\.(\\d*)");</p><p> 	var shell = new ActiveXObject("WScript.Shell");</p><p> 	var exec = shell.Exec("ipconfig.exe");</p><p> 	while (!exec.StdOut.AtEndOfStream) {</p><p> 		var line = exec.StdOut.ReadLine();</p><p> 		if (reg0.test(line) && reg1.test(line)) {</p><p> 			m = reg1.exec(line);</p><p> 			return m[0];</p><p> 		}</p><p> 	}</p><p> 	return null;</p><p> }</p><p> </p><p> var SLEEP_TIME = 60*1000;</p><p> var PORT = 8000</p><p> </p><p> WScript.Sleep(SLEEP_TIME); /* ネットワークが ready になるまで待つ. */</p><p> var ipaddr  = local_ip_addr();</p><p> var natupnp = new ActiveXObject("HNetCfg.NATUPnP");</p><p> var coll    = natupnp.StaticPortMappingCollection;</p><p> coll.Add(PORT, "TCP", PORT, ipaddr, true,  "Web");</p></pre><p></p><p>  これを "スタート" メニューに入れておけば事が足りるという次第. COM なので JavaScript(JScript) から使える. SDK があれば C++ からも使えるのだろうが, SDK は見当たらず. MSDN の森は深い. Windows は知らない API が山のようにある. なお, サーバを買う資金がなく計画は頓挫した. </p>
